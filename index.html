<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Times to Talk to Nathan</title>
	<link rel="stylesheet" type="text/css" href="style.css" />

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.3/jquery.mobile.structure-1.4.3.min.css" />
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.3/jquery.mobile-1.4.3.min.js"></script>
	
</head>

<body>
	<script>
	$(document).ready(function() {
		//initDate();
		$(window).resize();
		$(window).orientationchange();
	});

	function getDate()
	{
		var currentDate = new Date();
		var month = currentDate.getMonth() + 1;
		var day = currentDate.getDay(); // 0=SUN, 1=MON,...

		return day;
	}

	$(window).on("resize", function(event) {
		var c = document.getElementById("schedule");
		c.height = window.innerHeight;
		c.width = window.innerWidth;

		$(window).orientationchange();
	});

	$(window).on("orientationchange", function(event) {
		$("#orientation").text("This device is in "+event.orientation);
		if (event.orientation == "portrait")
		{
			// Portrait mode //
			redrawLayout(0);
		}
		else
		{
			// Landscape mode //
			redrawLayout(1);
		}

	});

	function redrawLayout(orient)
	{
		var c = document.getElementById("schedule");
		var context = c.getContext("2d");

		if (orient == 0)
		{
			context.fillStyle = "#E3E3E3";
			context.fillRect(0, 0, window.innerWidth, window.innerHeight);
		}

		// Draw sidebar time //
      	var tileHeight = (window.innerHeight - 25 - 15) / 11;

      	context.fillStyle = '#919191';
      	context.fillRect(5, 25, 30, window.innerHeight - 25 - 15);
      	context.fillStyle = "#545454";
      	context.fillRect(5, 25, 30, tileHeight);
      	context.fillRect(5, 25+tileHeight*2, 30, tileHeight);
      	context.fillRect(5, 25+tileHeight*4, 30, tileHeight);
      	context.fillRect(5, 25+tileHeight*6, 30, tileHeight);
      	context.fillRect(5, 25+tileHeight*8, 30, tileHeight);
      	context.fillRect(5, 25+tileHeight*10, 30, tileHeight);

		context.beginPath();
		context.rect(5, 25, 30, window.innerHeight - 25 - 15);
      	context.lineWidth = 2;
      	context.strokeStyle = 'black';
      	context.stroke();

      	context.font = "12pt Calibri";
      	context.textAlign = "center";
      	context.fillStyle = "#FFFFFF";
      	for (t = 0; t < 11; t++)
      	{
      		if (t < 5)
      			context.fillText(8+t, 20, 25.5 + tileHeight*t + 6 + (tileHeight / 2));
      		else
      			context.fillText(8+t-12, 20, 25.5 + tileHeight*t + 6 + (tileHeight / 2));
      	}

      	// Horizontal lines //
    	context.lineWidth = 0.25;
    	context.strokeStyle = "#000000";
    	for (l = 0; l < 12; l++)
    	{
    		context.beginPath();
    		context.moveTo(40, 25.5 + tileHeight * l);
    		context.lineTo(window.innerWidth - 5, 25 + tileHeight * l);
    		context.stroke();
    	}

    	// Draw schedule boxes //
    	var classes = [["#FF0000", "#00FF00"],
    				   ["#0000FF", "#0F0F00"],
    				   ["#574389", "#120933"],
    				   ["#234794", "#275929", "#016663"],
    				   ["#234721", "#194692"]];
    	var times   = [[[10.5, 2],[12.5, 2]],
    				   [[10.5, 1],[16.5,2]],
    				   [[8.5, 2], [11.5, 1]],
    				   [[8.5, 2], [12.5, 2], [2.5, 1]],
    				   [[9.5, 2], [4.5, 2]]];
    	//var day = initDate()-1;
    	
		var currentDate = new Date();
		//var month = currentDate.getMonth() + 1;
		var day = currentDate.getDay() - 1; // 0=MON, 1=TUES...
		//var day = 3;
		//var hours = currentDate.getHours();
		//var minutes = currentDate.getMinutes();
		//var offset = currentDate.getTimezoneOffset();

    	if (orient == 0) // Portrait //
    	{
    		var boxWidth = (window.innerWidth - 10 - 30 - 10) / 2;
    		/*
    		for (d = 0; d < 3; d++)
    		{
    			for (i = 0; i < classes[day+d].length; i++)
    			{
    				context.fillStyle = classes[day+d][i];
    				context.fillRect(40 + (d*boxWidth) + (d*5), 25 + (tileHeight * (times[day+d][i][0]-8)), boxWidth, (tileHeight * times[day+d][i][1]));
    			}
    		}
    		*/
    		for (d = day; d < day+1; d++)
    		{
    			for (i = 0; i < classes[d].length; i++)
    			{
    				context.fillStyle = classes[d][i];
    				context.fillRect(40 + (d-day)*boxWidth + (d-day)*5, 25 + (tileHeight * (times[d][i][0]-8)), boxWidth, (tileHeight * times[d][i][1]));
    			}
    		}
    	}
    	else // Landscape //
    	{
    		var boxWidth = (window.innerWidth - 10 - 30 - 10) / 5;
    		for (d = 0; d < 5; d++)
    		{
    			for (i = 0; i < classes[d].length; i++)
    			{
    				context.fillStyle = classes[d][i];
    				context.fillRect(40 + (d-day)*boxWidth + (d-day)*5, 25 + (tileHeight * (times[d][i][0]-8)), boxWidth, (tileHeight * times[d][i][1]));
    			}
    		}
    	}

    	// Draw time line //
    	var hour = (currentDate.getUTCHours() + 10) + (currentDate.getUTCMinutes()/60);
    	//var hour = 16;
    	var hourVert = 25 + ((hour - 8) * tileHeight);
    	//var hourVert = 200;
    	//context.fillText(hourVert, 150, 100);
    	context.beginPath();
    	context.strokeStyle = "#FF0000";
    	context.lineWidth = 4;
    	context.moveTo(40, hourVert+0.5);
    	context.lineTo(window.innerWidth - 5, hourVert+0.5);
    	context.stroke();
	}
	</script>

	<canvas id="schedule" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%"></canvas>

</body>

</html>
